const repassesGoverno = [
 {
    "orgao": "Polícia Civil",
    "data": "01/01/2024",
    "valor": 5500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Rodoviária Federal",
    "data": "02/01/2024",
    "valor": 6000.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Polícia Militar",
    "data": "03/01/2024",
    "valor": 4500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Corpo de Bombeiros",
    "data": "04/01/2024",
    "valor": 7000.00,
    "status": "sucesso"
  },
  {
    "orgao": "Guarda Municipal",
    "data": "05/01/2024",
    "valor": 3500.00,
    "status": "falha",
    "motivo": "Documentação incompleta"
  },
  {
    "orgao": "Receita Federal",
    "data": "06/01/2024",
    "valor": 8000.00,
    "status": "sucesso"
  },
  {
    "orgao": "Ministério Público",
    "data": "07/01/2024",
    "valor": 9000.00,
    "status": "falha",
    "motivo": "Erro no sistema"
  },
  {
    "orgao": "Defesa Civil",
    "data": "08/01/2024",
    "valor": 4000.00,
    "status": "sucesso"
  },
  {
    "orgao": "Detran",
    "data": "09/01/2024",
    "valor": 5000.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Federal",
    "data": "10/01/2024",
    "valor": 6500.00,
    "status": "falha",
    "motivo": "Falta de recursos"
  },
  {
    "orgao": "Ibama",
    "data": "11/01/2024",
    "valor": 5500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Anvisa",
    "data": "12/01/2024",
    "valor": 6000.00,
    "status": "sucesso"
  },
  {
    "orgao": "Inmetro",
    "data": "13/01/2024",
    "valor": 3000.00,
    "status": "falha",
    "motivo": "Dados incorretos"
  },
  {
    "orgao": "Cetesb",
    "data": "14/01/2024",
    "valor": 7000.00,
    "status": "sucesso"
  },
  {
    "orgao": "Susep",
    "data": "15/01/2024",
    "valor": 8000.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Polícia Civil",
    "data": "16/01/2024",
    "valor": 5200.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Rodoviária Federal",
    "data": "17/01/2024",
    "valor": 6100.00,
    "status": "falha",
    "motivo": "Erro humano"
  },
  {
    "orgao": "Polícia Militar",
    "data": "18/01/2024",
    "valor": 4600.00,
    "status": "sucesso"
  },
  {
    "orgao": "Corpo de Bombeiros",
    "data": "19/01/2024",
    "valor": 7100.00,
    "status": "sucesso"
  },
  {
    "orgao": "Guarda Municipal",
    "data": "20/01/2024",
    "valor": 3600.00,
    "status": "falha",
    "motivo": "Sistema fora do ar"
  },
  {
    "orgao": "Receita Federal",
    "data": "21/01/2024",
    "valor": 8100.00,
    "status": "sucesso"
  },
  {
    "orgao": "Ministério Público",
    "data": "22/01/2024",
    "valor": 9100.00,
    "status": "falha",
    "motivo": "Recursos insuficientes"
  },
  {
    "orgao": "Defesa Civil",
    "data": "23/01/2024",
    "valor": 4100.00,
    "status": "sucesso"
  },
  {
    "orgao": "Detran",
    "data": "24/01/2024",
    "valor": 5100.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Federal",
    "data": "25/01/2024",
    "valor": 6600.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Ibama",
    "data": "26/01/2024",
    "valor": 5600.00,
    "status": "sucesso"
  },
  {
    "orgao": "Anvisa",
    "data": "27/01/2024",
    "valor": 6100.00,
    "status": "sucesso"
  },
  {
    "orgao": "Inmetro",
    "data": "28/01/2024",
    "valor": 3100.00,
    "status": "falha",
    "motivo": "Dados incorretos"
  },
  {
    "orgao": "Cetesb",
    "data": "29/01/2024",
    "valor": 7100.00,
    "status": "sucesso"
  },
  {
    "orgao": "Susep",
    "data": "30/01/2024",
    "valor": 8100.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Polícia Civil",
    "data": "31/01/2024",
    "valor": 5300.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Rodoviária Federal",
    "data": "01/01/2024",
    "valor": 6200.00,
    "status": "falha",
    "motivo": "Erro humano"
  },
  {
    "orgao": "Polícia Militar",
    "data": "02/01/2024",
    "valor": 4700.00,
    "status": "sucesso"
  },
  {
    "orgao": "Corpo de Bombeiros",
    "data": "03/01/2024",
    "valor": 7200.00,
    "status": "sucesso"
  },
  {
    "orgao": "Guarda Municipal",
    "data": "04/01/2024",
    "valor": 3700.00,
    "status": "falha",
    "motivo": "Sistema fora do ar"
  },
  {
    "orgao": "Receita Federal",
    "data": "05/01/2024",
    "valor": 8200.00,
    "status": "sucesso"
  },
  {
    "orgao": "Ministério Público",
    "data": "06/01/2024",
    "valor": 9200.00,
    "status": "falha",
    "motivo": "Recursos insuficientes"
  },
  {
    "orgao": "Defesa Civil",
    "data": "07/01/2024",
    "valor": 4200.00,
    "status": "sucesso"
  },
  {
    "orgao": "Detran",
    "data": "08/01/2024",
    "valor": 5200.00,
    "status": "sucesso"
  },
  {
    "data": "09/01/2024",
    "valor": 6700.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Ibama",
    "data": "10/01/2024",
    "valor": 5700.00,
    "status": "sucesso"
  },
  {
    "orgao": "Anvisa",
    "data": "11/01/2024",
    "valor": 6200.00,
    "status": "sucesso"
  },
  {
    "orgao": "Inmetro",
    "data": "12/01/2024",
    "valor": 3200.00,
    "status": "falha",
    "motivo": "Dados incorretos"
  },
  {
    "orgao": "Cetesb",
    "data": "13/01/2024",
    "valor": 7200.00,
    "status": "sucesso"
  },
  {
    "orgao": "Susep",
    "data": "14/01/2024",
    "valor": 8200.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Polícia Civil",
    "data": "15/01/2024",
    "valor": 5400.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Rodoviária Federal",
    "data": "16/01/2024",
    "valor": 6300.00,
    "status": "falha",
    "motivo": "Erro humano"
  },
  {
    "orgao": "Polícia Militar",
    "data": "17/01/2024",
    "valor": 4800.00,
    "status": "sucesso"
  },
  {
    "orgao": "Corpo de Bombeiros",
    "data": "18/01/2024",
    "valor": 7300.00,
    "status": "sucesso"
  },
  {
    "orgao": "Guarda Municipal",
    "data": "19/01/2024",
    "valor": 3800.00,
    "status": "falha",
    "motivo": "Sistema fora do ar"
  },
  {
    "orgao": "Receita Federal",
    "data": "20/01/2024",
    "valor": 8300.00,
    "status": "sucesso"
  },
  {
    "orgao": "Ministério Público",
    "data": "21/01/2024",
    "valor": 9300.00,
    "status": "falha",
    "motivo": "Recursos insuficientes"
  },
  {
    "orgao": "Defesa Civil",
    "data": "22/01/2024",
    "valor": 4300.00,
    "status": "sucesso"
  },
  {
    "orgao": "Detran",
    "data": "23/01/2024",
    "valor": 5300.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Federal",
    "data": "24/01/2024",
    "valor": 6800.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Ibama",
    "data": "25/01/2024",
    "valor": 5800.00,
    "status": "sucesso"
  },
  {
    "orgao": "Anvisa",
    "data": "26/01/2024",
    "valor": 6300.00,
    "status": "sucesso"
  },
  {
    "orgao": "Inmetro",
    "data": "27/01/2024",
    "valor": 3300.00,
    "status": "falha",
    "motivo": "Dados incorretos"
  },
  {
    "orgao": "Cetesb",
    "data": "28/01/2024",
    "valor": 7300.00,
    "status": "sucesso"
  },
  {
    "orgao": "Susep",
    "data": "29/01/2024",
    "valor": 8300.00,
    "status": ""
  },
  {
    "orgao": "Polícia Civil",
    "data": "30/01/2024",
    "valor": 5500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Rodoviária Federal",
    "data": "31/01/2024",
    "valor": 6400.00,
    "status": "falha",
    "motivo": "Erro humano"
  },
  {
    "orgao": "Polícia Militar",
    "data": "01/01/2024",
    "valor": 4900.00,
    "status": "sucesso"
  },
  {
    "orgao": "Corpo de Bombeiros",
    "data": "02/01/2024",
    "valor": 7400.00,
    "status": "sucesso"
  },
  {
    "orgao": "Guarda Municipal",
    "data": "03/01/2024",
    "valor": 3900.00,
    "status": "falha",
    "motivo": "Sistema fora do ar"
  },
  {
    "orgao": "Receita Federal",
    "data": "04/01/2024",
    "valor": 8400.00,
    "status": "sucesso"
  },
  {
    "orgao": "Ministério Público",
    "data": "05/01/2024",
    "valor": 9400.00,
    "status": "falha",
    "motivo": "Recursos insuficientes"
  },
  {
    "orgao": "Defesa Civil",
    "data": "06/01/2024",
    "valor": 4400.00,
    "status": "sucesso"
  },
  {
    "orgao": "Detran",
    "data": "07/01/2024",
    "valor": 5400.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Federal",
    "data": "08/01/2024",
    "valor": 6900.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Ibama",
    "data": "09/01/2024",
    "valor": 5900.00,
    "status": "sucesso"
  },
  {
    "orgao": "Anvisa",
    "data": "10/01/2024",
    "valor": 6400.00,
    "status": "sucesso"
  },
  {
    "orgao": "Inmetro",
    "data": "11/01/2024",
    "valor": 3400.00,
    "status": "falha",
    "motivo": "Dados incorretos"
  },
  {
    "orgao": "Cetesb",
    "data": "12/01/2024",
    "valor": 7400.00,
    "status": "sucesso"
  },
  {
    "orgao": "Susep",
    "data": "13/01/2024",
    "valor": 8400.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Polícia Civil",
    "data": "14/01/2024",
    "valor": 5600.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Rodoviária Federal",
    "data": "15/01/2024",
    "valor": 6500.00,
    "status": "falha",
    "motivo": "Erro humano"
  },
  {
    "orgao": "Polícia Militar",
    "data": "16/01/2024",
    "valor": 5000.00,
    "status": "sucesso"
  },
  {
    "orgao": "Corpo de Bombeiros",
    "data": "17/01/2024",
    "valor": 7500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Guarda Municipal",
    "data": "18/01/2024",
    "valor": 4000.00,
    "status": "falha",
    "motivo": "Não informado"
  },
  {
    "orgao": "Receita Federal",
    "data": "19/01/2024",
    "valor": 8500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Ministério Público",
    "data": "20/01/2024",
    "valor": 9500.00,
    "status": "falha",
    "motivo": "Recursos insuficientes"
  },
  {
    "orgao": "Defesa Civil",
    "data": "21/01/2024",
    "valor": 4500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Detran",
    "data": "22/01/2024",
    "valor": 5500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Federal",
    "data": "23/01/2024",
    "valor": 7000.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Ibama",
    "data": "24/01/2024",
    "valor": 6000.00,
    "status": "sucesso"
  },
  {
    "orgao": "Anvisa",
    "data": "25/01/2024",
    "valor": 6500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Inmetro",
    "data": "26/01/2024",
    "valor": 3500.00,
    "status": "falha",
    "motivo": "Dados incorretos"
  },
  {
    "orgao": "Cetesb",
    "data": "27/01/2024",
    "valor": 7500.00,
    "status": "sucesso"
  },
  {
    "orgao": "Susep",
    "data": "28/01/2024",
    "valor": 8500.00,
    "status": "falha",
    "motivo": "Problemas técnicos"
  },
  {
    "orgao": "Polícia Civil",
    "data": "29/01/2024",
    "valor": 5700.00,
    "status": "sucesso"
  },
  {
    "orgao": "Polícia Rodoviária Federal",
    "data": "30/01/2024",
    "valor": 6600.00,
    "status": "falha",
    "motivo": "Erro Humano"
  },
  {
    "orgao": "Polícia Militar",
    "data": "31/01/2024",
    "valor": 5100.00,
    "status": "sucesso"
  }
]
/*console.log("Primeiro repasse:", repassesJson[0])*/

const totalRepasses = repassesGoverno.length
console.log("RELATORIO DE REPASSES")
console.log("Total de repasses do Governo:", totalRepasses)

function resultadoSucesso(lista) {
    return lista.filter(item => item.status === "sucesso").length;
}
console.log("Quantidade total de repasses bem sucedidos:", resultadoSucesso(repassesGoverno));

function sucessoPorOrgao(lista) {
    return lista.reduce((acc, item) => {
        if (item.status === "sucesso") {
            acc[item.orgao] = (acc[item.orgao] || 0) + 1;
        }
        return acc;
    }, {});
}

const resultado = sucessoPorOrgao(repassesGoverno)
console.log("Quantidade total de repasses bem sucedidos por órgão:", resultado)

function valorTotalRepassesSucesso(lista) {
    return lista
        .filter(item => item.status === "sucesso") 
        .reduce((total, item) => total + item.valor, 0)
}
const totalValorSucesso = valorTotalRepassesSucesso(repassesGoverno);
console.log("Valor total de repasses bem sucedidos: R$", totalValorSucesso.toFixed(2));

function valorTotalSucessoPorOrgao(lista) {
    return lista.reduce((acc, item) => {
        if (item.status === "sucesso") {
            acc[item.orgao] = (acc[item.orgao] || 0) + item.valor;
        }
        return acc;
    }, {});
}

const valoresPorOrgao = valorTotalSucessoPorOrgao(repassesGoverno);
console.log("Valor total de repasses bem sucedidos por órgão:", valoresPorOrgao);

function resultadofalha(lista) {
    return lista.filter(item => item.status === "falha").length;
}
console.log("Quantidade total de repasses com falha:", resultadofalha(repassesGoverno));

function resultadofalhaporOrgao(lista) {
    return lista
        .filter(item => item.status === "falha") 
        .reduce((accumulador, item) => {
            const orgao = item.orgao || "Sem orgao informado"; 
            if (accumulador[orgao]) {
                accumulador[orgao] += 1; 
            } else {
                accumulador[orgao] = 1; 
            }
            return accumulador;
        }, {});
}
console.log("Quantidade total de repasses com falha por orgao:", resultadofalhaporOrgao(repassesGoverno));

function repassesFalhaPorMotivo(lista) {
    return lista
        .filter(item => item.status === "falha") 
        .reduce((accumulador, item) => {
            const motivo = item.motivo || "Sem motivo informado"; 
            if (accumulador[motivo]) {
                accumulador[motivo] += 1; 
            } else {
                accumulador[motivo] = 1; 
            }
            return accumulador;
        }, {});
}
console.log("Quantidade total de repasses com falha por motivo:", repassesFalhaPorMotivo(repassesGoverno));

function Valortotalderepassescomfalha(lista) {
    return lista
        .filter(item => item.status === "falha") 
        .reduce((total, item) => total + item.valor, 0)
}
const totalValorFalha = Valortotalderepassescomfalha(repassesGoverno);
console.log("Valor total de repasses com falha: R$", totalValorFalha.toFixed(2));

function Valortotalderepassescomfalhaporórgão(lista) {
    return lista.reduce((acc, item) => {
        if (item.status === "falha") {
            acc[item.orgao] = (acc[item.orgao] || 0) + item.valor;
        }
        return acc;
    }, {});
}

const valoresfalhaPorOrgao = Valortotalderepassescomfalhaporórgão(repassesGoverno);
console.log("Valor total de repasses com falha por órgão:", valoresfalhaPorOrgao);

function Valortotalderepassescomfalhapormotivo(lista) {
    return lista.reduce((acc, item) => {
        if (item.status === "falha") {
            acc[item.motivo] = (acc[item.motivo] || 0) + item.valor;
        }
        return acc;
    }, {});
}

const valoresfalhaPormotivo = Valortotalderepassescomfalhapormotivo(repassesGoverno);
console.log("Valor total de repasses com falha por motivo:", valoresfalhaPormotivo);

function obterRepasseComMaiorValor(lista) {
    return lista.reduce((maior, item) => 
        Number(item.valor) > Number(maior.valor) ? item : maior
    );
}

const repasseMaiorValor = obterRepasseComMaiorValor(repassesGoverno);

console.log("a. Detalhes do repasse com maior valor:");
console.log(repasseMaiorValor);

function obterRepasseComMenorValor(lista) {
    return lista.reduce((menor, item) => 
        Number(item.valor) < Number(menor.valor) ? item : menor
    );
}

const repasseMenorValor = obterRepasseComMenorValor(repassesGoverno);

console.log("b. Detalhes do repasse com menor valor:");
console.log(repasseMenorValor);

const Diacommaisrepasses = lista => Object.entries(lista.reduce((c, {data}) => (c[data]=(c[data]||0)+1, c), {})).sort((a,b)=>b[1]-a[1])[0][0];

console.log("c. Dia com mais repasses:", Diacommaisrepasses(repassesGoverno));

const Orgaocommaisrepasses = lista => Object.entries(lista.reduce((c, {orgao}) => (c[orgao]=(c[orgao]||0)+1, c), {})).sort((a,b)=>b[1]-a[1])[0][0];

console.log("d. Órgão com mais repasses:", Orgaocommaisrepasses(repassesGoverno));

function orgaoComMaisRepasses(lista) {
    const contagem = {};
    
    lista.forEach(item => {
        if (item.status === "sucesso") {
            contagem[item.orgao] = (contagem[item.orgao] || 0) + 1;
        }
    });

    return Object.keys(contagem).reduce((a, b) => contagem[a] > contagem[b] ? a : b);
}

const resultadomais = orgaoComMaisRepasses(repassesGoverno);
console.log("e. Órgão com mais repasses com sucesso:", resultadomais);

function Repassesfalhas(lista) {
    const contagem = {};
    
    lista.forEach(item => {
        if (item.status === "falha") {
            contagem[item.orgao] = (contagem[item.orgao] || 0) + 1;
        }
    });

    return Object.keys(contagem).reduce((a, b) => contagem[a] > contagem[b] ? a : b);
}

const resultados = Repassesfalhas(repassesGoverno);
console.log("f. Órgão com mais repasses falhados:", resultados);

const motivoMaisFrequente = Object.entries(
  repassesGoverno
    .filter(item => item.status === "falha")
    .reduce((acc, item) => {
      const motivo = item.motivo || "Sem motivo informado";
      acc[motivo] = (acc[motivo] || 0) + 1;
      return acc;
    }, {})
).sort((a, b) => b[1] - a[1])[0]?.[0] || "Nenhum motivo";

console.log("g. Motivo de falha com mais repasses:", motivoMaisFrequente);

const orgaoEscolhido = "Polícia Civil";

const filtrados = repassesGoverno.filter(item => item.orgao === orgaoEscolhido);

console.log("Usuario 4: a. RELATÓRIO DO ÓRGÃO:", orgaoEscolhido);
console.log("Total de repasses:", filtrados.length);

const sucesso = filtrados.filter(item => item.status === "sucesso");
console.log("Repasses com sucesso:", sucesso.length);

const falha = filtrados.filter(item => item.status === "falha");
console.log("Repasses com falha:", falha.length);

const totalSucesso = sucesso.reduce((soma, item) => soma + item.valor, 0);
console.log("Valor total de sucesso: R$", totalSucesso.toFixed(2));

const totalfalha = falha.reduce((soma, item) => soma + item.valor, 0);
console.log("Valor total por falha: R$", totalfalha.toFixed(2));

const motivos = falha.map(item => item.motivo || "Sem motivo informado");
console.log("Motivos das falhas:", motivos);

const orgaoEscolhidos = "Ibama";

const resultadoss = repassesGoverno.filter(item => item.orgao === orgaoEscolhidos);

console.log("========================================");
console.log("  Usuario 4: b. RELATÓRIO DE TRANSAÇÕES POR ÓRGÃO");
console.log("  Órgão selecionado:", orgaoEscolhidos);
console.log("  Total encontrado:", resultadoss.length);
console.log("========================================\n");

resultadoss.forEach((item, index) => {
    console.log(`Transação ${index + 1}:`);
    console.log("Órgão:", item.orgao);
    console.log("Data:", item.data);
    console.log("Valor: R$", item.valor.toFixed(2));
    console.log("Status:", item.status);

    if (item.status === "falha") {
        console.log("Motivo da falha:", item.motivo || "Não informado");
    }

    console.log("----------------------------------------");
});

const orgaos = [...new Set(repassesGoverno.map(item => item.orgao).filter(Boolean))];

console.log("=== Usuario 4: c. MENU AUTOMÁTICO DE ÓRGÃOS ===");
orgaos.forEach((o, i) => console.log(`${i + 1}. ${o}`));

const oorgaoEscolhido = orgaos[0];

console.log("\nÓrgão selecionado automaticamente:", oorgaoEscolhido);
console.log("=================================\n");

let ttotalSucesso = 0;
let valorTotalSucesso = 0;
let totalFalha = 0;
let falhaPorMotivo = {};
let sucessoPorOrgaos = {};

const transacoesValidas = repassesGoverno.filter(item =>
    item.status !== "falha" || (typeof item.motivo === "string" && item.motivo.trim() !== "")
);

transacoesValidas.forEach(item => {
    if (item.status === "sucesso") {
        ttotalSucesso++;
        valorTotalSucesso += Number(item.valor || 0);
        const orgao = item.orgao || "Desconhecido";
        sucessoPorOrgao[orgao] = (sucessoPorOrgao[orgao] || 0) + 1;
    } else if (item.status === "falha") {
        totalFalha++;
        const motivo = item.motivo.trim();
        falhaPorMotivo[motivo] = (falhaPorMotivo[motivo] || 0) + 1;
    }
});

const orgaoMaisSucesso = Object.keys(sucessoPorOrgao).length > 0
    ? Object.keys(sucessoPorOrgao).reduce((a, b) => sucessoPorOrgao[a] > sucessoPorOrgao[b] ? a : b)
    : null;

console.log("Total de transações válidas:", transacoesValidas.length);
console.log("Total de repasses bem sucedidos:", ttotalSucesso);
console.log("Valor total de repasses bem sucedidos: R$", valorTotalSucesso.toFixed(2));
console.log("Total de repasses com falha (válidos):", totalFalha);
console.log("Falhas válidas por motivo:", falhaPorMotivo);
console.log("Órgão com mais repasses bem sucedidos:", orgaoMaisSucesso);